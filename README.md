# lockfile
Read, write, and convert npm (v1, v2) and yarn (classic and berry) lockfiles in any directions with reasonable losses.

### Motivation
Every package manager brings its own philosophy of how to describe, store and control projects dependencies.
It's awesome for developers, but literally becomes a ~~pain in *** ***~~ headache for isec, devops and release engineers.
This lib is a naive attempt to build a pm-independent, generic, extensible and reliable dependency representation.

### Getting started
#### Install
```shell
yarn add @antongolub/lockfile
```

#### Usage
```js
import { parse, format } from '@antongolub/lockfile'

const parsed = parse({
  lockfile: './yarn.lock',
  pkg: './package.json'
})

// output
{
  map: {
    '@babel/code-frame@7.10.4': {
      version: '7.10.4',
      scope: 'prod/dev/peer/opt',
      integrity: {
        sha512: 'hashsum',
        sha256: '...',
        sha1: '...',
        checksum: '...'
      },
      reference: {
        sourceType: 'npm/git/file/workspace'
        sourceUri: 'uri://remote/address',
        linkType: 'hard/soft',
        link: '<root>path/to/package'
      },
      dependencies: {
        '@babel/highlight': '^7.10.4'
      }
    },
    ...
  },
  meta: {
    format: '0.0.0',
    workspaces: {
      patterns: ['./packages/*'],
      packages: {
        '@qiwi/pijma-core': '<root>/packages/core/package.json'
      }
    }
  },
}

const data = format({
  ...parsed,
  lockfileType: 'yarn2'
})
// output
`
# This file is generated by running "yarn install" inside your project.
# Manual changes might be lost - proceed with caution!

__metadata:
  version: 5
  cacheKey: 8

"@babel/code-frame@npm:7.10.4":
  version: 7.10.4
  resolution: "@babel/code-frame@npm:7.10.4"
...
`
```

### Inspired by
* [synp](https://github.com/imsnif/synp)
* [snyk-nodejs-lockfile-parser](https://github.com/snyk/nodejs-lockfile-parser)

### License
[MIT](./LICENSE)
